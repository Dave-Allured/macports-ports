# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           gitlab 1.0
PortGroup           legacysupport 1.1
PortGroup           meson 1.0

# CLOCK_MONOTONIC
##legacysupport.newest_darwin_requires_legacy 15

gitlab.instance     {https://gitlab.freedesktop.org}
gitlab.setup        wayland wayland 1.24.0
gitlab.master_sites ${gitlab.homepage}/-/releases/${gitlab.version}/downloads
epoch               1
revision            0

categories          devel graphics
license             MIT
maintainers         nomaintainer
description         Core Wayland protocol and libraries
long_description    ${description}

checksums           rmd160  5d60e12bd452d5a65e82da7191c6d35a5bf0c617 \
                    sha256  82892487a01ad67b334eca83b54317a7c86a03a89cfadacfef5211f11a5d0536 \
                    size    241764

# Gitlab 1.0 portgroup bug prevents normal use of "use_xz".
# https://trac.macports.org/ticket/64960, not correctly fixed yet.
#use_xz              yes
extract.suffix      .tar.xz
extract.cmd         xz

depends_build-append \
                    path:bin/cmake:cmake \
                    path:bin/pkg-config:pkgconfig

depends_lib-append  port:libffi \
                    port:libxml2

#patch.pre_args-replace  -p0 -p1
#patchfiles-append   0001-Darwin-fixes-from-owl-compositor.patch \
#                    0002-wayland-os.c-LOCAL_PEERPID-may-not-be-defined.patch \
#                    0003-os-wrappers-test-F_DUPFD_CLOEXEC-may-not-be-defined.patch

# stdatomic.h
compiler.c_standard 2011

configure.args-append \
                    -Ddocumentation=false \
                    -Ddtd_validation=true \
                    -Dlibraries=true \
                    -Dscanner=true \
                    -Dtests=true

test.run            yes

#github.livecheck.branch darwin-portability
